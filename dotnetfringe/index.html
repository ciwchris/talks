<!DOCTYPE html>
<html>
  <head>
    <title>Clojure, Elixir and .Net Core: a newbie's experience</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="casts/asciinema-player.css" />
    <style>
      @import url(YanoneKaffeesatz.css);
      @import url(DroidSerif.css);
      @import url(UbuntuMono.css);

      .image-overlay {position:absolute; top:200px; left: 0; width:100%; text-align: center; }
      .jumbo { font-size: 400%; font-family: hack }
      .right-col { position:absolute; top:0; right: 0; }
      blockquote {
          padding: 10px 20px;
          margin: 0 0 20px;
          font-size: 150%;
          border-left: 5px solid #eee;
          text-align: left;
      }
      blockquote footer {
          display: block;
          font-size: 80%;
          line-height: 1.42857143;
          color: #777;
      }
      blockquote footer::before {
          content: '\2014 \00A0';
      }
      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      table {
          border: 1px solid #ddd;
          margin-left: auto;
          margin-right: auto;
          border-spacing: 0;
          border-collapse: collapse;
      }
      th {
          border: 1px solid #ddd;
          padding: 8px;
          border-spacing: 0;
          border-collapse: collapse;
      }
      tbody tr:nth-of-type(2n+1) {
          background-color: #f9f9f9;
      }
      tbody tr td {
          border: 1px solid #ddd;
          padding: 8px;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
      .clojure-page-break { background-color: #90dc46; color: white; }
      .clojure-page-break .hljs {background-color: #90dc46 !important; font-size: 16px; }
      .takeaways { margin-left: 150px; font-size: 35px; font-family: 'Yanone Kaffeesatz'; }
      .elixir-page-break { background-color: #4a3358; color: white; }
      .dotnet-page-break { background-color: #682a7b; color: white; }

    </style>
  </head>
  <body>

    <textarea id="source">

class: center, middle

# Clojure, Elixir and .Net Core: a newbie's experience

![Clojure](images/clojure-logo.png)
![Elixir](images/elixir-logo.png)
![.Net](images/dotnet-logo.png) 


### Christopher Lopes
### @ciwchris

???

- Hi I'm Chris Lopes
- Welcome to the recounting of my experience

---

class: center, middle

![Closed](images/come-in-were-closed.jpg)

???

- I'm a web developer
- Moonlight checking kids into classrooms, slick system
- More kids than classroom space
- Therefore one of my duties
- Can't monitor on phone, need to interrupt

---

class: center, middle

![Admin Over Capacity](images/admin-over-capacity.png)

???

- Hope the classroom limit
- Teachers none to happy
- Experiencing this unpleasantness
- With this knowledge

---

class: center, middle

![Check in](images/app-open-full-framed.png)
![Counts](images/app-counts-framed.png)

???

- First: status, identified by color, next to the check in screen screen
- Web socket connection to the server
- System sends a web hook
- Server send requests to the API
- Broadcasts to connected clients
- Second: count, buttons to increment/decrement, kid is moved
- Figured, good small, learning project, real need
- But before I talk about the app be helpful to know my background and what prospective I bring

- Talk is my reflections after implementing in different stacks

---

class: center, middle

![Me](images/dilpert.jpe)
# Microsoft all the things

???

- entire pro career Windows web dev, asp
- Typical developer
- More than a day job
- Not going home every night
- Twitter, Podcasts, Videos
- Consult StackOverflow often, rarely contribute
- Attend occasional conference but have never spoken

---

class: center, middle

![SO](images/nuget.png)

???

- At work we're all in, NuGet to install our libs
- Surprise, Angular

---

class: center, middle

--
![grunt](images/grunt.png)
--
![gulp](images/gulp.png)
--
![browserify](images/browerify.png)
--
![webpack](images/webpack.jpe)
--
<br />
![rollupjs](images/rollupjs.png)
--
![babel](images/babel.png)
--
![eslint](images/eslint.png)
--
![rxjs](images/rxjs.jpe)


???

- No JavaScript build process, etc
- BundleTransformer to transpile, bundle and minify.

---

class: center, middle

![SO](images/arch.png)

???

- Atypical
- Doing any asp.net, not friendly
- Mono impressive
- [strike: Quicksilver, Gnome Do]
- Challenges: NuGet

---

class: center, middle

![SO](images/mono-cli.png)

???

- Looking at early versions of omnisharp
- Limit on cli, how even to get started?
- Guess I can answer now
- With that in mind let's talk about

---

class: center, middle, clojure-page-break

![Clojure](images/clj.png)
![Clojure](images/cljs.png)

???

- Dialect of Lisp
- Dynamic, Several implementations, CLR, Primary JVM
- Interoperability with Java, consume each others libs
- ClojureScript, JavaScript using Google Closure Library
- Cognitect maintainer, Rich Hickey benevolent dictator for life

---

## Parens and infix

```clojure
user=> (+ 1 2 3 4)
10
user=> (+ 1 (* 2 3) 4)
11
```

## Branching

```clojure
user=> (def hello "hello")
#'user/hello
user=> (def world "world")
#'user/world
user=> (if
  #_=>     (or
  #_=>         (and (= hello "hello") (= world "world"))
  #_=>         (not= hello world))
  #_=>     (str hello " " world))
"hello world"
```


???

- If you haven't worked in a lisp
- Parentheses and prefix notation
- Parens are a list. Lists are evaluated, S-expressions
- First position is operator, rest arguments
- Don't have to remember precedence
- Evaluation inside out
- Simple and consistent

---

## Map, filter and reduce

```clojure
user=> (map inc (range 1 10))
(2 3 4 5 6 7 8 9 10)
user=> (filter even? (range 1 10))
(2 4 6 8)
user=> (reduce + (range 1 10))
45
user=> (reduce + (filter even? (map inc (range 1 10))))
30

```
## Threading macro

```clojure
user=> (->>
         (range 1 10)
         (map inc)
         (filter even?)
         (reduce +))
30
```

???

- Basic functions map, filter, reduce
- Begin to see the common complaint, parens
- Used to them, proper editor, structure for readality
- Pipes result, readality

---

class: center, middle

# Leiningen

![Leiningen](images/leiningen.jpg)

???

- Most prevalent to automate project related tasks
- Similar to NPM
- Project templates, dependencies, build, run tests, repl, more
- Community plugins, write own

---

class: center, middle

--

# Ring + Compojure

???

- No end-to-end web framework
- Ring base (Ruby Rack), other libraries, typically Compojure for routing

---

class: center, middle

# Arachne

![Arachne](images/arachne-logo.jpe)

???

- Identified as issue, kickstarter campaign
- Goal of approachable beginners, pluggable for adavanced

---

class: center, middle

# Reagent

![Reagent](images/reagent-logo.png)

???

- Other side of the story, ClojureScript
- Several wrap React (JS framework), Reagent
- React components in ClojureScript
- Lein template, server side bits
- Best way to get started

---

class: center, middle

## Installation and getting started

<div id="clojure-create"></div>

???

- Let's begin our project, first installation
- Reader conditionals

---

## Setup routes

```clojure
(defroutes site-routes
  (GET "/" [] (render-file "templates/index.html" env))
  (GET "/checkins" [] {:status 200
                       :body (api/create-list-of-checkin-count-by-group env)})
  (POST "/newcheckin" request {:status 200
                               :body (api/register-checkin request env)})
  (resources "/")
  (not-found "Not Found"))
```

???

- Routes using Compojure

---

## Retrieve check-ins

```clojure
(defn- retrieve-checkins
  ([] (retrieve-checkins 1 @checkins-store))
  ([page-number checkins]
   (let [today (.toString (time/today) "MM/dd/yyyy")
         new-checkins (retrieve-checkins-for-result-page page-number)
         new-checkin-store (add-new-checkins-to-checkins-store checkins new-checkins today)]
     (if (not= (count new-checkin-store) (count checkins))
       (retrieve-checkins (inc page-number) new-checkin-store)
       (do
         (swap! checkins-store into checkins)
         @checkins-store)))))
```

???

- Algorithm not important, instead focus on code structure
- Overloaded function
- No arguments, calls itself with initial
- Request to system API, results stored in map
- 20 check-in entries are returned, entries do not exist send another
- Once we have all check-ins the map is returned

---

## Configuration

```clojure
{:key "xxxxxxxxxxxxxxxxxxxxxxx"
 :user-token "xxxxxxxxxxxxxxxx"}
```

## Read in configuration

```clojure
(defn- load-config
  []
  (edn/read-string (slurp "src/clj/kids_checkin/config.edn")))
```

## Use

```clojure
(let [config (load-config)
    (:user-token config))
```

???

- API key and token
- Stored in an edn file, contain clojure data, pulled into application
- Env vars using Environ

---

## Java interop

```clojure
(defn- create-secret-key [key mac]
* (SecretKeySpec. (.getBytes key) (.getAlgorithm mac)))

(defn- sign-text-with-key
  [key string]
* (let [mac (Mac/getInstance "HMACSHA256")
        secretKey (create-secret-key key mac)]
    (-> (doto mac
          (.init secretKey)
          (.update (.getBytes string)))
        .doFinal)))
```

???

- HMAC authentication, no Clojure library
- Trivial to use Java interopt
- SecretKeySpec constructor
- Mac getIntance, then used

---

## Creating check-in counts

```clojure
(defn- count-checkins-for-classrom
  [classroom-id checkins]
  (count (filter #(= classroom-id (second %)) checkins)))

(defn create-classroom-counts
  [checkins]
  [{:color "red" :count (count-checkins-for-classroom 108117 checkins)…}
   {:color "orange" :count (count-checkins-for-classroom 108119 checkins)…}
   {:color "yellow" :count (count-checkins-for-classroom 108120 checkins)…}
   {:color "green" :count (count-checkins-for-classroom 144673 checkins)…}
   {:color "blue" :count (count-checkins-for-classroom 108123 checkins)…}
   {:color "purple" :count (count-checkins-for-classroom 89515 checkins)…}])
```

???

- Request to retrieve check-ins, list is created for each classroom, calculates the count

---

## ClojureScript: page initialization

```clojure
(defn mount-root []
  (reagent/render [checkin-page] (.getElementById js/document "app")))

(defn save-checkins [response]
  (swap! checkins (fn [] response)))

(defn get-checkins []
    (GET "/checkins" {:handler save-checkins}))
```

???

- Mounts component, like React

---

## Create components

```clojure
(defn list-classes [checkins]
  [:div
   [:ul
    (for [class checkins]
      ^{:key (:id class)} [:li
                           [:div {:style {:background-color (:color class)}}
                            (str (:name class) " " (:count class) "/" (:max class))]])]])

(defn checkin-page []
  [:div
   [list-classes @checkins]])
```

???

- Create a container, bottom
- Pass check-ins to, top, which iterates, creating a container for each classroom
- The version of app outputs name and count

---

class: center, middle

![Figwheel](images/figwheel.png)

???

- Creates a websocket connection and hotloads code
- Error messages simpler

---

## Interacting with browser

```clojure
ClojureScript:cljs.user> (js/alert "Hello world!")
```

## Changing classroom count

```clojure
ClojureScript:cljs.user> (in-ns 'kids-checkin.core)
nil
ClojureScript:kids-checkin.core> (def incremented-counts (map #(assoc % :count 2) @classrooms))
ClojureScript:kids-checkin.core> (swap! classrooms (fn [] incremented-counts))
({:color "red", :count 2, …}
 {:color "orange", :count 2, …}
 {:color "yellow", :count 2, …}
 {:color "green", :count 2, …}
 {:color "blue", :count 2, …}
 {:color "purple", :count 2, …})

```

???

- classrooms outputted 2x, only showing once here
- Hooks up browser repl

---

class: center, middle

# Deployment: Heroku

![Heroku](images/heroku-logo.png)

???

- Reagent Procfile to deploy to Heroku
- Bare min instructions
- Information, supply configuration, not discussed

---

class: clojure-page-break

# Takeaways

.takeaways[
- Community enthusiastic and active
- Repl driven development
- ClojureScript refreshing
- Figwheel simplifies workflow
- Editor?
- No complete out of the box web framework
- Tougher to come back to
]

???

- Community: friendly, enthusiastic, positive, active, lots of libraries
- Repl handy, instead of debugging and inspecting, problem forget what you did, no tests
- ClojureScript is fun and refreshing, bypass all js tooling/decisions, dead code elimination
- Emacs/Spacemacs, Cursive
- No framework to guide, lot of work past to figure out past Reagent
- Tougher to come back, how did that work, how did I use the tool => greater learning curve

---

class: small, clojure-page-break

```clojure
(defn keep
  "Returns a lazy sequence of the non-nil results of (f item). Note,
  this means false return values will be included.  f must be free of
  side-effects.  Returns a transducer when no collection is provided."
  {:added "1.2"
   :static true}
  ([f]
   (fn [rf]
     (fn
       ([] (rf))
       ([result] (rf result))
       ([result input]
          (let [v (f input)]
            (if (nil? v)
              result
              (rf result v)))))))
  ([f coll]
   (lazy-seq
    (when-let [s (seq coll)]
      (if (chunked-seq? s)
        (let [c (chunk-first s)
              size (count c)
              b (chunk-buffer size)]
          (dotimes [i size]
            (let [x (f (.nth c i))]
              (when-not (nil? x)
                (chunk-append b x))))
          (chunk-cons (chunk b) (keep f (chunk-rest s))))
        (let [x (f (first s))]
          (if (nil? x)
            (keep f (rest s))
            (cons x (keep f (rest s))))))))))
```
--
.image-overlay[![Terse](images/terse-lisp.png)]

???

- Keep, removes nil
- Reading the clojure code of others
- Common practice: terse, hard to read, single letter names

---

class: clojure-page-break

```
Exception in thread "main" clojure.lang.ArityException: Wrong number of args (2) passed to: StringReader: (abnf.clj:189:28)
    at clojure.lang.Compiler$InvokeExpr.eval(Compiler.java:3628)
    at clojure.lang.Compiler$InvokeExpr.eval(Compiler.java:3622)
    at clojure.lang.Compiler$DefExpr.eval(Compiler.java:439)
    at clojure.lang.Compiler.eval(Compiler.java:6787)
    at clojure.lang.Compiler.load(Compiler.java:7227)
    at clojure.lang.RT.loadResourceScript(RT.java:371)
    at clojure.lang.RT.loadResourceScript(RT.java:362)
    at clojure.lang.RT.load(RT.java:446)
    at clojure.lang.RT.load(RT.java:412)
    at clojure.core$load$fn__5448.invoke(core.clj:5866)
    at instaparse.core$eval9510.invoke(core.clj:1)
    at clojure.lang.AFn.applyToHelper(AFn.java:156)
    at clojure.lang.Var.applyTo(Var.java:700)
    at clojure.main.main(main.java:37)
Caused by: clojure.lang.ArityException: Wrong number of args (2) passed to: StringReader
    at clojure.lang.AFn.throwArity(AFn.java:429)
    at clojure.lang.AFn.invoke(AFn.java:36)
    at instaparse.cfg$build_rule.invoke(cfg.clj:214)
    at clojure.core$map$fn__4553.invoke(core.clj:2622)
    at clojure.core$into.invoke(core.clj:6600)
    at instaparse.cfg$ebnf.invoke(cfg.clj:277)
    at clojure.lang.AFn.applyToHelper(AFn.java:154)
    at clojure.lang.AFn.applyTo(AFn.java:144)
    at clojure.lang.Compiler$InvokeExpr.eval(Compiler.java:3623)
    ... 125 more
```
.right-col[![Stack](images/clojure-stack.png)]

???

- Challenging figure out errors, misleading
- Constant high item on state of clojure survey, improving, clojure.spec
- Community helpful, cataloging exceptions, how to read
- That's Clojure, how about Elixir

---

class: center, middle, elixir-page-break

![Elixir](images/elixir.png)

???

- Dynamic, built on/extends Erlang, runs on Erlang VM/BEAM
- Runs in processes sending messages to each other
- Not OS processes or threads, extremely lightweight, tens of thousands simultaneously
- Distributed systems, scale horizontally
- Jose Valim, Plataformatec

---

## Pattern matching

```elixir
iex(1)> a = "hello"
"hello"
iex(2)> "hello" = a
"hello"
iex(3)> "world" = a
   (MatchError) no match of right hand side value: "hello"
```

```elixir
iex(1)> {hello, world} = {"hello", "world"}
{"hello", "world"}
iex(2)> {hello, "world"} = {"hello", "world"}
{"hello", "world"}
iex(3)> {hello, "world!"} = {"hello", "world"}
   (MatchError) no match of right hand side value: {"hello", "world"}
iex(3)> case {:ok, "hello world"} do
...(3)>      {:ok, result} -> IO.puts result
...(3)>      {:error, result} -> IO.puts result
...(3)>      _ -> IO.puts "something unexpected"
...(3)> end
hello world
:ok
```

???

- Important concept
- Not equal is assignment, match operator
- Tuples used often, send data or return multiple pieces from function
- Used with destructing to extract and branch on results, if statements less frequently
- Match any

---

## In function definitions

```clojure
iex(1)> hello = fn
...(1)>     %{:name => name} -> "Hello " <> name
...(1)>     %{:first => first, :last => last} -> "Hello " <> first <> " " <> last
...(1)>     _ -> "Hello"
...(1)> end
#Function<6.50752066/1 in :erl_eval.expr/5>
iex(2)> hello.(%{:name => "full name"})
"Hello full name"
iex(3)> hello.(%{:first => "first", :last => "last"})
"Hello first last"
iex(4)> hello.(%{:first => "first", :last => "last", :name => "full name"})
"Hello full name"
iex(5)> hello.(1)               
"Hello"
```

???

- Bind function to hello
- Pattern match definition
- Match anything

---

## Map, filter and reduce

```elixir
iex(1)> Enum.map(1..10, fn x -> x + 1 end)
[2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
iex(2)> Enum.filter(1..10, fn x -> 0 == rem(x, 2) end)
[2, 4, 6, 8, 10]
iex(3)> Enum.reduce(1..10, fn(x, acc) -> acc + x end)
55
```

## Using pipes

```elixir
iex(4)> 1..10 \                                  
...(4)>     |> Enum.map(fn x -> x + 1 end) \
...(4)>     |> Enum.filter(fn x -> 0 == rem(x, 2) end) \
...(4)>     |> Enum.reduce(fn(x, acc) -> acc + x end)
30
```

???

- Comparison: map, filter and reduce
- Pipe operator, inspired by f#.
- Backslash is for the repl

---

## Storing state using processes

```elixir
iex(1)> {:ok, agent} = Agent.start_link fn -> [] end
{:ok, #PID<0.86.0>}
iex(2)> Agent.update(agent, fn list -> ["hello world" | list] end)
:ok
iex(3)> Agent.get(agent, fn list -> list end)
["hello world"]
iex(4)> Agent.stop(agent)
:ok
```

???

- Processes are used to store state
- OTP set of libraries for working with processes, Open Telecom Platform
- Agent abstraction to store state
- Process started with an empty list, list updated by prepending, list retrieved, process stopped

---

class: center, middle

# Mix

![Mix](images/elixir.png)

???

- Similar to leiningen, manage projects
- Comes with elixir installation
- Create, manage dependencies, run tests, compile

---

class: center, middle

# Phoenix

![Phoenix](images/phoenix-framework.png)

--

.image-overlay[![Phoenix Tweet](images/phoenix-naming.png)]

???

- Predominate web framework
- Complete out of the box solution
- On surface familiar to other web frameworks
- MVC ORM, Brunch on front end for asset management

---

## Installation and getting started

<div id="elixir-create"></div>

???

- Let's begin our Elixir app

---

## Setup routes

```Elixir
pipeline :browser do
  plug :accepts, ["html"]
  plug :protect_from_forgery
  plug :put_secure_browser_headers
end

pipeline :api do
  plug :accepts, ["json"]
end

scope "/", KidsCheckin do
  pipe_through :browser

  get "/", PageController, :index
  get "/counts", PageController, :counts
end

scope "/api", KidsCheckin do
  pipe_through :api

  post "newcheckin", WebHookController, :index
end
```

???

- Requests different pipelines, scopes
- Plug, elixir for composable web components
- Page requests and api requests different scopes, different pipelines

---

## Retrieve check-ins

```elixir
defp retrieve_checkins(checkins, page) do
  new_checkins = Enum.filter(
    get_checkins_for_page(page),
    fn checkin -> is_today(checkin["checked_in_at"])
  end)

  cond do
    Enum.count(new_checkins) == 0 -> create_classroom_counts checkins
    !Map.has_key?(checkins, hd(Enum.reverse new_checkins)["barcode"]) ->
      retrieve_checkins(map_checkins(new_checkins, checkins), (page + 1)
    )
    true -> create_classroom_counts map_checkins(new_checkins, checkins)
  end
end
```

???

- Request to system API, retrieve last 20 check-ins
- Results filtered to current day
- No new check-ins, return current list
- New check-ins, don't have last check-in, recursion next page
- Already have last one, merge lists and return

---

## Configuration

```elixir
config :kids_checkin, :thecity_secret_key, "xxxxxxxxxxxxxxxxxxxxx"
config :kids_checkin, :thecity_user_token, "xxxxxxxxxxxxxxxx"
```

## Include

```elixir
use Mix.Config

import_config "thecity.secret.exs"
```
## Use

```elixir
Application.get_env(:kids_checkin, :thecity_secret_key)
```

???

TODO: details on the separate file

- Dev: separate config file, not in source control
- Production environment variables

---

## Erlang interop

```elixir
defp get_checkins_page(page) do
  url = "https://api.onthecity.org/checkins?page=" <> to_string(page)
*  time = :os.system_time(:milli_seconds)
*  signed = :crypto.hmac(
    :sha256,
    Application.get_env(:kids_checkin, :thecity_secret_key),
    "#{time}GET#{url}"
  ) |> Base.encode64 |> URI.encode_www_form

  response = HTTPoison.get!(url, [
        {"X-City-Sig", signed},
        {"X-City-User-Token", Application.get_env(:kids_checkin, :thecity_user_token)},
        {"X-City-Time", time},
        {"Accept", "application/vnd.thecity.admin.v1+json"}
      ])
  {:ok, checkins} = decode response.body
  checkins["checkins"]
end
```

???

- No library for HMAC signature
- Easy to call Erlang function directly
- Pipe to encode

---

## Creating check-in counts

```elixir
def create_classroom_counts(checkins) do
  [
    %{"color" => "red", "count" => get_counts(checkins, 108117), …},
    %{"color" => "orange", "count" => get_counts(checkins, 108119), …},
    %{"color" => "yellow", "count" => get_counts(checkins, 108120), …},
    %{"color" => "green", "count" => get_counts(checkins, 144673), …},
    %{"color" => "blue", "count" => get_counts(checkins, 108123), …},
    %{"color" => "purple", "count" => get_counts(checkins, 89515), …}
  ]
end

defp get_counts(checkins, id) do
  Enum.filter(Map.values(checkins), fn checkin -> checkin == id end) |> Enum.count
end
```

???

- List is created with properties of each classroom in a map
- Count is found by looking at id of classroom.

---

## Websockets with Phoenix

```javascript
import {Socket} from 'phoenix';

let socket = new Socket('/socket', {params: {token: window.userToken}});
socket.connect();
let channel = socket.channel('checkins:count', {});

channel.on("count_update", payload => {
    let classes = JSON.parse(payload.classes);
    for (var i = 0; i < classes.length; i++) {
        var text = classes[i].count < classes[i].max
            ? 'Open'
            : 'Full';
        $('#'+ classes[i].color).text(text);
    }
});

channel.join()
    .receive('ok', resp => { console.log('Joined successfully', resp); })
    .receive('error', resp => { console.log('Unable to join', resp); });
```

???

- Phoenix has websockets and Babel (modules es2015 features)
- Import the phoenix module
- When new event is broadcasted, payload looped through, updating status

---

class: center, middle

# Deployment: Heroku

![Heroku](images/heroku-logo.png)

???

- Phoenix provides thorough guide, creating Heroku account to pushing
- Setup environment variables, secret keys, buildpack to use
- Enforcing HTTPS

---

class: elixir-page-break

# Takeaways

.takeaways[
- Phoenix fit my need perfectly
- Elixir and Phoenix docs thorough
- Easy to come back to
- Lot of momentum
- Community smaller, tougher to search on
- Editor?
- Elected not to use OTP, Phoenix abstracts too much?
]

???

- Phoenix: nice websockets and JS pipeline
- Docs are thorough
- Easy to come back to
- A lot of momentum, community growing quickly
- Newer, community smaller, tougher to search on
- What editor to use
- Didn't use OTP, use what I know (app cache), wasn't forced to change as much

---

class: dotnet-page-break, center, middle

![.Net](images/dotnet.png) 

???

- We'll skip the introduction

---

class: center, middle

![Ubuntu Only](images/ubuntu-only.png)

---

class: center, middle

![AUR CLI](images/aur-cli.png)

---

class: center, middle

<div id="dotnet-create"></div>

???

---

## Setup routes

```csharp
public void Configure()
{
    app.UseMvc(routes =>
    {
        routes.MapRoute(
            name: "default",
            template: "{controller=Home}/{action=Index}/{id?}");
    });
}
```
```csharp
[Route("api/[controller]")]
public class NewCheckinController : Controller
{
    [HttpPost]
    public IActionResult Create()
    {
        var classroomList = checkinRetrievalService.CreateNewClassroomList();
        BroadcastNewList(classroomList);

        return Ok();
    }
}
```

???

- Standard MVC
- Standard WebAPI attributes

---

## Retrieve check-ins

```csharp
public async Task<Dictionary<string, string>> CreateUpdatedCheckinList()
{
    var currentCheckins = cache.Get("checkins") as Dictionary<string, string> ?? new Dictionary<string, string>();
    var page = 1;
    Dictionary<string, string> newCheckins;

    do
    {
        newCheckins = GetCheckinsOnPage(page++).Result;
    } while(WasUnseenCheckinReceived(currentCheckins, newCheckins));
    cache.Set("checkins", currentCheckins);

    return await Task.Run(() => currentCheckins);
}

private bool WasUnseenCheckinReceived(Dictionary<string, string> current, Dictionary<string, string> newCheckins)
{
    var count = current.Count();
    newCheckins.ToList().ForEach(entry => current[entry.Key] = entry.Value);
    return count != current.Count();
}
```

???

- Use in memory
- Retrieve checkins, add to list (sneaky state), see if counts are different
- Set new list

---

## Configuration


```csharp
public Startup(IHostingEnvironment env)
{
    var builder = new ConfigurationBuilder().SetBasePath(env.ContentRootPath);

    if (env.IsDevelopment()) builder.AddUserSecrets();

    builder.AddEnvironmentVariables();
    Configuration = builder.Build();
}
```

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddOptions();
    services.Configure<ApiConfiguration>(apiOptions =>
    {
        apiOptions.SecretKey = Configuration["secretKey"];
        apiOptions.Token = Configuration["token"];
    });
}
```

```csharp
public CheckinRetrievalService(IMemoryCache cache, IOptions<ApiConfiguration> apiConfiguration)
```

???

- Secret config, environment var
- Register the config object
- DI

---

## Creating check-in counts

```csharp
private List<CheckinProperties>() CreateNewClassroomList()
{
    var checkins = checkinRetrievalService.CreateUpdatedCheckinList().Result;

    var counts = new List<CheckinProperties>(); 
    counts.Add(new CheckinProperties { Color = "red", Count = GetClassroomCount("108117", checkins), …}); 
    counts.Add(new CheckinProperties { Color = "orange", Count = GetClassroomCount("108119", checkins), …});
    counts.Add(new CheckinProperties { Color = "yellow", Count = GetClassroomCount("108120", checkins), …});
    counts.Add(new CheckinProperties { Color = "green", Count = GetClassroomCount("144673", checkins), …});
    counts.Add(new CheckinProperties { Color = "blue", Count = GetClassroomCount("108123", checkins), …});
    counts.Add(new CheckinProperties { Color = "purple", Count = GetClassroomCount("89515", checkins), …});

    return counts;
}
```

```csharp
private int GetClassroomCount(string id, Dictionary<string, string> checkins)
{
    return checkins.Where(checkin => checkin.Value == id).Count();
}
```

???

---

## Websockets

```javascript
webSocket = new WebSocket(scheme + location.host);

webSocket.onopen = function () {
    console.log('connected');
};

webSocket.onclose = function () {
    console.log('disconnected');
};

webSocket.onmessage = function (evt) {
    var classes = JSON.parse(evt.data);
    for (var i = 0; i < classes.length; i++) {
        var text = classes[i].count < classes[i].max ? 'Open' : 'Full';
        $('#'+ classes[i].color).text(text);
    }
};
```

???

- No SignalR
- Open connection, update when message

---

class: center, middle

![Azure](images/azure.png)

???

- Azure
- Setup git push
- Turn on websocket, looked at key vault, went with env var

---

class: dotnet-page-break

# Takeaways

.takeaways[
- Quickly progressing
- Good docs, but out of date
- Editor?
- Secret Manager
- Community: good & bad
- Missing pieces
- Right at home
]

???

TODO: brad wilson tweet?

- Ubuntu 14.04/16.04/AUR (relied on community)
- At RC2 docs no longer accurate, git issues: sample apps in repos nice
- Nice to have editor option, but: ominsharp, debugger, vim (crash)
- Secret solution, not encrypted, but no diff
- Libraries: sidelines (less options now), tired of chasing RC2, but responsive: nicholas - sirilog
- Dotnet cli, nice, but limited. Community needs to dive in. Yeoman has Nancy
- No SignalR for websockets
- Skills transferable, good for those invested and make the move

---

class: center

# Comparison

| Clojure        | Elixir        | .Net Core   |
|----------------|---------------|-------------|
| JVM            | BEAM          | CLR         |
| lein           | mix           | dotnet      |
| Maven          | Hex           | NuGet       |
| Ring/Compojure | Phoenix       | ASP.NET MVC |
| CLJS           | Brunch        | Bower/Gulp  |
| Repl           | IEx           | Repl?       |
| Emacs          | Emacs         | VS Code     |
| Cognitect      | Plataformatec | Microsoft   |

???

- Lot of similar components, but for a different set of problems, still interesting to compare
- .Net missing repl, but better debug experience
- Microsoft big player, others little guys (cosulting), implications -> community
- Tendency to look to them, bring into fold, asp.net monsters

---

# Community/Call to action

All communities have their problems. Clojure: bugs not addressed, no complete framework. Elixir: grow too fast. Phoenix abstracts too much. Wrong answers to questions.

Now is a time of great opportunity. .net developers are going to be forced to change. Remember how mentioned the way we do development at work. All of that is going to change. We will have to adopt new practices. Now is an rare time the community can step in and fill a need.

---

class: center, middle

<blockquote>
  <p>I am only one, but I am one. I can't do everything, but I can do something. And that I can do, I ought to do. And what I ought to do, by the grace of God, I shall do.</p>
  <footer>Edward Everett Hale</footer>
</blockquote>

???

- Inspire. Take part. Take something on. Be part of a team. Encourage. Positive comments.

---

class: center, middle

.jumbo[Ctrl^D]

???

- Thank you and
- Discuss any of this, questions, ideas share knowledge I'll be around, find me, Thanks!

    </textarea>
    <script src="remark-latest.min.js"></script>
    <script>
        var slideshow = remark.create({
            ratio: '16:9',
            slideNumberFormat: '',
            highlightLines: true
        });
    </script>
    <script src="casts/asciinema-player.js"></script>
    <script>
        asciinema.player.js.CreatePlayer(
            'clojure-create',
            'casts/clojure-creation.json',
            {
                poster: 'npt:1',
                speed: 1.5,
                width: 80,
                height: 18,
                fontSize: 'medium',
                theme: 'solarized-light'
            });
        asciinema.player.js.CreatePlayer(
            'elixir-create',
            'casts/elixir-creation.json',
            {
                poster: 'npt:1',
                speed: 1.5,
                width: 80,
                height: 18,
                fontSize: 'medium',
                theme: 'solarized-light'
            });
        asciinema.player.js.CreatePlayer(
            'dotnet-create',
            'casts/dotnet-creation.json',
            {
                poster: 'npt:1',
                speed: 1.5,
                width: 80,
                height: 18,
                fontSize: 'medium',
                theme: 'solarized-light'
            });
    </script>
  </body>
</html>
